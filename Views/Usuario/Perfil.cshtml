@model inmobiliaria_Toloza_Lopez.Models.Usuario
@{
    ViewData["Title"] = "Mi Perfil";
    var userRol =
    ((System.Security.Claims.ClaimsIdentity)User.Identity).FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value;
}


<h1>@ViewData["Title"]</h1>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header text-center">
                    <h2>@ViewData["Title"]</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <form method="POST" asp-controller="Usuario" asp-action="Update" asp-route-id="@Model.id"
                                enctype="multipart/form-data">
                                @if (userRol == "administrador")
                                {
                                    @foreach (var property in new[] { ("nombre", Model.nombre), ("apellido",
                                Model.apellido),("dni",Model.dni),("email",Model.email),("rol",Model.rol) })
                                    {
                                        <div class="form-group">
                                            <label for="@property.Item1">@property.Item1:</label>
                                            <input type="text" id="@property.Item1" name="@property.Item1" class="form-control"
                                                value="@property.Item2" disabled>
                                        </div>
                                    }
                                    <div class="form-group">
                                        <label for="@Model.borrado">Activo:</label>
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="borrado" name="borrado"
                                                value="true" @(Model.borrado == false ? "checked" : "") />
                                            <label class="custom-control-label" for="borrado"></label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="image">Imagen de perfil:</label>
                                        <input type="file" id="image" name="avatarFile" class="form-control"
                                            accept="image/*" disabled>
                                    </div>
                                }
                                else
                                {
                                    @foreach (var property in new[] { ("nombre", Model.nombre), ("apellido",
                                Model.apellido),
                                ("dni",Model.dni) })
                                    {
                                        <div class="form-group">
                                            <label for="@property.Item1">@property.Item1:</label>
                                            <input type="text" id="@property.Item1" name="@property.Item1" class="form-control"
                                                value="@property.Item2" disabled>
                                        </div>
                                    }
                                    <div class="form-group">
                                        <label for="image">Imagen de perfil:</label>
                                        <input type="file" id="image" name="avatarFile" class="form-control"
                                            accept="image/*" disabled>
                                    </div>
                                }
                                <button id="btnEditar" class="btn btn-primary mt-3"
                                    onclick="toggleEdicion(event)">Editar
                                    Perfil</button>
                                <button id="btnGuardar" class="btn btn-success mt-3" onclick="mostrarAlerta(event)"
                                    style="display: none;">Guardar Cambios</button>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <div class="card mt-4">
                                <div class="card-header text-center">
                                    <h2>Avatar</h2>
                                </div>
                                <div class="card-body d-flex justify-content-center">
                                    <img src="@Url.Content("~/uploads/"+ Model.avatarUrl)" alt="Avatar"
                                        class="img-fluid" style="max-width: 100px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const nombreInput = document.getElementById("nombre");
        const apellidoInput = document.getElementById("apellido");
        const dniInput = document.getElementById("dni");
        const btnEditar = document.getElementById("btnEditar");
        const btnGuardar = document.getElementById("btnGuardar");
        function toggleEdicion(event) {
            event.preventDefault();
            nombreInput.disabled = !nombreInput.disabled;
            apellidoInput.disabled = !apellidoInput.disabled;
            dniInput.disabled = !dniInput.disabled;
            var imageInput = document.getElementById("image");
            imageInput.disabled = !imageInput.disabled;

            if (nombreInput.disabled) {
                btnEditar.textContent = "Editar Perfil";
                btnGuardar.style.display = "none";
            } else {
                btnEditar.textContent = "Cancelar";
                btnGuardar.style.display = "block";
            }
        }
        function mostrarAlerta(event) {
            event.preventDefault();
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¿Quieres guardar los cambios?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, guardar cambios!'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire(
                        'Guardado!',
                        'Tus cambios han sido guardados.',
                        'success'
                    )
                    document.querySelector('form').submit();
                }
            })
        }
    </script>
}
